<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="./simulation.css">
	<style>
	@import url('https://fonts.googleapis.com/css?family=Quicksand:500|Roboto+Slab:700');

	body{
		background: white;
		font-family: 'Quicksand', Arial;
		margin: 0px;
	}

	h1{
		font-family: 'Roboto Slab', Arial;
		color: black;
	}

	input, button{
		font-size: inherit;
		font-family: inherit;
	}

	button{
		font-family: inherit;
	}

	textarea{
		resize: none;
		padding: 10px;
		width: 640px;
		height: 200px;
	}

	.next-button-layer{
		text-align: center;
	}

	.next-button{
		width: 200px;
		display: inline-block;
		margin: auto;
		line-height: 50px;
		margin-bottom: 50px;
	}

	.page-header{
		text-align: center;
		font-size: 40px;
		margin-bottom: 20px;
		background:  #737495;
		line-height: 100px;
		font-family: 'Roboto Slab', Arial;
		color: white;
		text-shadow: 0px -1px black;
	}

	.chapter-header{
		line-height: 50px;
		font-family: 'Roboto Slab', Arial;
		font-size: 30px;
		text-align: center;
		color: #737495;
	}

	.name-entry{

	}

	.name-entry label{
		width: 100px;
		margin-right: 10px;
	}

	.name-entry input{
		width: 450px;
		margin-top: 10px;
	}

	.name-entry button{
		width: 450px;
		padding: 10px;
		margin: auto;
		margin-top: 30px;
		margin-left: 115px;
		display: inline-block;
	}

	.lesson-menu{
		text-align: center;
		margin-bottom: 20px;
	}

	.lesson-menu button{
		display: inline-block;
		margin: auto;
		width: 200px;
		line-height: 30px;
		font-size: 20px;
		padding: 10px 0px;
		cursor: pointer;
	}

	.module{
		max-width: 700px;
		margin: auto;
		margin-bottom: 10px;
		text-align: left;
		padding: 20px;
		border-radius: 10px;
	}

	label{
		display: inline-block;
		width: 100px;
		text-align: right;
		padding-right: 5px;
	}

	ul{
		text-align: left;
		padding-top: 0px;
		margin-top: 0px;
	}

	li{
		padding: 10px;
	}

	input{
		padding: 10px;
		display: inline-block;
		position: relative;
	}

	.input-list{

	}
 
	.input-list input{
		width: 600px;
	}

	.solution-input{
		padding: 10px;
	}

	.solution-input input{
		width: 300px;
	}

	.community-list{
		color:#F17D80;
	}


	.community-list input{
		width: 470px;
		margin-bottom: 5px;
	}

	.input-list button, .community-list button{
		width: 100px;
		padding: 10px;
	}

	.solution-input button{
		padding: 10px;
		width: 300px;
	}

	h1{
		margin: 0px;
		padding: 0px;
		font-weight: normal;
		font-size: 20px;
		padding: 0px;
		background: linear-gradient(to right, #68A8AD, white);
		line-height: 40px;
		padding-left: 10px;
	}

	h2{
		padding: 0px;
		font-size: 15px;
		color: #555;
		font-weight: normal;
		font-style: italic;
	}

	.hidden-fact{
		margin-top: 5px;
		background: none;
		border:none;
	}

	.hidden-fact h1{
		color: #68A8AD;
		background: none;
		cursor: pointer;
		position: relative;
		border-top: none;
	}

	.hidden-fact h1 .actual{
		display: none;
		vertical-align: middle;
	}

	.hidden-fact h1 .psuedo:after{
		content: "(Hover for more info)";
		margin-left: 10px;
		font-size: 12px;
		vertical-align: middle;
		font-style: italic;
	}

	.hidden-fact h1:hover .psuedo{
		display: none;
	}

	.hidden-fact h1:hover .actual{
		display: inline;
	}

	.hidden-fact h1:before{
		content: "+";
		margin-right: 10px;
		font-weight: bold;
		display: inline;
	}

	.hidden-fact .reveal{
		display: none;
		padding: 10px;
	}

	.hidden-fact.revealed .reveal{
		display: block;
	}

	.hidden-fact.revealed h1 .psuedo{
		display: none;
	}

	.hidden-fact.revealed h1 .actual{
		display: inline-block;
	}

	.hidden-fact.community h1{
		color: #F17D80;
	}

	.hidden-fact.fact h1{
		color: #6C8672;
	}

	.video-player{
		position: relative;
		display: inline-block;
		cursor: pointer;
		text-align: center;
	}

	.video-player:before{
		content: "►";
		position: absolute;
		top:0px;
		left:0px;
		right:0px;
		bottom:0px;
		background: rgba(0,0,0,0.5);
		color: white;
		line-height: 360px;
		font-size: 200px;
		text-shadow: 0px 0px 10px black;
	}

	.video-player.playing:before{
		display: none;
	}

	.video-player video{
		width: 640px;
		height: 360px;
		background: black;
	}

	.timer{
		position: absolute;
		top: -10px;
		right: -25px;
		width: 100px;
		height: 100px;
		background: white;
		border: 1px solid #bbb;
		line-height: 100px;
		text-align: center;
		border-radius: 50px;
		font-size: 20px;
	}

	.module-header{
		font-size: 25px;
		text-align: center;
	}

	
	</style>
	<script type="text/javascript" src='./jquery-3.2.1.min.js'></script>

	<script type="text/javascript" src='./Simulation.js'></script>
	<script type="text/javascript">
		

		var questionsTime = 
		[
			{id:'time-1',type:'time',rate:100,l:10,h:10,b:10},
			{id:'time-2',type:'time',rate:100,l:15,h:15,b:15},
			{id:'time-3',type:'time',rate:100,l:20,h:20,b:20},
		]
		
		var questionsRate = 
		[
			{id:'rate-1',type:'rate',rate:100,l:10,h:10,b:10},
			{id:'rate-2',type:'rate',rate:80,l:10,h:10,b:10},
			{id:'rate-3',type:'rate',rate:200,l:10,h:10,b:10},
		]

		var questionsVolume = 
		[
			{id:'volume-1',type:'volume',rate:100,l:10,h:10,b:10},
			{id:'volume-2',type:'volume',rate:100,l:15,h:15,b:15},
			{id:'volume-3',type:'volume',rate:100,l:25,h:10,b:15},
		]

		var nameOfPerson;

		function init(){
			
			$('.lesson-menu').hide();
			$('.lesson').hide();
			$('.next-button').hide();
			$('.name-entry button').click(function(){
				var first = $('.name-entry input').eq(0).val();
				var last = $('.name-entry input').eq(1).val();

				if(first.length && last.length){
					$('.name-entry').hide();
					$('.next-button').show();
					$('.lesson-menu').show();
					nameOfPerson = first + ' ' + last;
					$('.module-header').text("Welcome, "+nameOfPerson+"!");
					launch();
				}
			});


			function launch(){

				var iLesson = 0;
				var iModule = 0;

				$('.next-button').click(function(){
					if($('.lesson').eq(iLesson).find('.module').length <= iModule){
						iLesson ++;
						iModule = 0;
					}

					toCurrentLessonAndModule();
				});

				$('.lesson-menu button').click(function(){
					iLesson = $('.lesson-menu button').index(this);
					iModule = 0;
					toCurrentLessonAndModule();
				});

				function toCurrentLessonAndModule(){
					iModule++;
					$('.lesson').hide();
					$('.lesson').eq(iLesson).show();
					$('.lesson').eq(iLesson).find('.module').hide();
					for(var i=0; i<iModule; i++) $('.lesson').eq(iLesson).find('.module').eq(i).show();

					$('.next-button').hide();
					console.log( $('.lesson').eq(iLesson).find('.module').length > iModule, $('.lesson').length > iLesson, $('.lesson').length, iLesson )
					if( $('.lesson').eq(iLesson).find('.module').length == iModule ) $('.next-button').text("NEXT CHAPTER");
					else $('.next-button').text("NEXT");
					if( $('.lesson').eq(iLesson).find('.module').length > iModule || $('.lesson').length > (iLesson+1) ) $('.next-button').show();
				}

				$('.hidden-fact h1').click(function(){
					$(this).closest('.hidden-fact').toggleClass('revealed');
				});

				new VideoPlayer($('.video-player'));

				var $elSimulationClone = $('.simulation').clone();

				new Simulation($('.simulation'));

				for(var i=0;i<questionsTime.length;i++){
					var $elClone = $elSimulationClone.clone().appendTo($('.simulation-questions').eq(0));
					new Simulation($elClone,questionsTime[i]);
				}

				for(var i=0;i<questionsRate.length;i++){
					var $elClone = $elSimulationClone.clone().appendTo($('.simulation-questions').eq(1));
					new Simulation($elClone,questionsRate[i]);
				}

				for(var i=0;i<questionsVolume.length;i++){
					var $elClone = $elSimulationClone.clone().appendTo($('.simulation-questions').eq(2));
					new Simulation($elClone,questionsVolume[i]);
				}

				new CommunityList($('.input-list').eq(0),true)
				new CommunityList($('.input-list').eq(1),true)
				new CommunityList($('.input-list').eq(2),true)

				new CommunityList($('.community-list').eq(0))
				new CommunityList($('.community-list').eq(1))
				new CommunityList($('.community-list').eq(2))

				$('.data-list').each(function(){
					new CommunityList($(this),true);
				})

				

				new QuestionInput($('.solution-input'),14.8,'solution');
			}
		}



		function VideoPlayer($el){
			$el.click(function(){
				$(this).addClass('playing');
				
				var video = $(this).find('video')[0]
				video.play()
				video.currentTime = 0;

				var $timer = $(this).find('.timer');
				if($timer.length){

					var fillStartsAt = 11.2;
					var fillEndsAt = 26;
					if($timer.data('start')) fillStartsAt = $timer.data('start');
					if($timer.data('end')) fillEndsAt = $timer.data('end');

					var idInterval = setInterval(function(){
						if(video.currentTime>=fillEndsAt) clearInterval(idInterval);
						time = video.currentTime-fillStartsAt;
						time = Math.max(0,Math.min(time,fillEndsAt));
						$timer.html(time.toFixed(2));
					},0);
				}
			})
		}

		function InputList($el){
			$el.find('button').click(function(){
				var str = $el.find('input').val();
				if(!str.length){
					$el.find('input').animate({left:-20},50).animate({left:20},50).animate({left:-20},50).animate({left:0},50);
					return;
				}
				$('<li>').appendTo($el.find('ul')).text(str);
				$el.find('input').val('');
			});
		}

		function CommunityList($el,isPrivate){
			var id = $el.data('id');

			function addEntry(id,name,entry){
				var url = './add.php';

				$.ajax(url,{
					complete:onResponse,
					data:{id:id,entry:entry,name:name},
					method:'GET',
				})
			}

			function getEntries(id,name){
				var url = './get.php';

				$.ajax(url,{
					complete:onResponse,
					data:{id:id,name:name},
					method:'GET',
				})
			}

			function onResponse(response){

				var $ul = $el.find('ul');
				var list = JSON.parse(response.responseText);
				$ul.empty();
				for(var i=0;i<list.length;i++){
					if (isPrivate) $('<li>').appendTo($ul).text(list[i].entry);
					else $('<li>').appendTo($ul).text(list[i].entry+' ('+list[i].name+')');
				}

				if(!list.length){
					var message = "No community responses yet. Why not add one below.";
					if(isPrivate) message = "Add your responses below.";
					$('<li>').appendTo($ul).text(message);
				}
			}


			function reload(){
				if(isPrivate) getEntries(id,nameOfPerson);
				else getEntries(id);
			}

			reload();
			setInterval(function(){
				if( $el.is(':visible')) reload();
			},2000);

			$el.find('button').click(function(){
				var name = nameOfPerson;
				var entry = $el.find('input').val();

				if(!entry.length) $el.find('input').eq(0).animate({left:-20},50).animate({left:20},50).animate({left:-20},50).animate({left:0},50);
				if(!entry.length) return;

				addEntry(id,name,entry);
				$el.find('input').val('');
			});
		}

		function QuestionInput($el,solution,id){

			function onResponse(response){
				console.log(response);
			}

			function addEntry(id,name,entry){
				var url = './add.php';

				$.ajax(url,{
					complete:onResponse,
					data:{id:id,entry:entry,name:name},
					method:'GET',
				})
			}

			var cntAttempt = 0;
			$el.find('button').click(function(){
				cntAttempt++;
				
				var entered = $el.find('input').val();
				if(!entered.length) return;

				addEntry(id,nameOfPerson,entered);

				if(Math.round(solution*10) == Math.round(entered*10)){
					$el.find('button').text('Correct!');
					$el.find('button').attr('disabled','disabled');
					$el.find('input').attr('disabled','disabled');
				}
				else if(cntAttempt == 1){
					$el.find('button').text('Oops! Try Again.');
				}
				else{
					$el.find('button').attr('disabled','disabled');
					$el.find('input').attr('disabled','disabled');
					$el.find('button').text('Oops! Correct answer is '+solution+'.');
				}
			});
		}
		

	</script>
</head>
<body onload="init()">
	<div class='page-header'>The Plight of the Plastic Box</div>
	<div class='module-header'></div>

	<div class='module'>
	<div class='name-entry'>
		<h1>Let's get started. What is your name?</h1>
		<label>First Name</label><input></input><br>
		<label>Last Name</label><input></input><br>
		<button>Let's Go!</button>
	</div>
	</div>
	<div class='lesson-menu'>
		<button>Chapter 1<br>The Experiment</button>
		<button>Chapter 2<br>The Simulator</button>
		<button>Chapter 3<br>The Sequel</button>
		<button>Chapter 4<br>Results</button>
	</div>
	<div class='lesson'>
	<div class='module'>
		<div class='chapter-header'>Chapter 1 : The Experiment</div>
	</div>
	<div class='module'>
	<h1>Watch this container fill up.</h1>
	<div class='video-player'>
	<video>
		<source src='./fill-partial.mp4'>
	</video>
	</div>
	</div>
	<div class='module'>
	<h1>What questions does this video raise for you?</h1>
	<div class='input-list' data-id='inquiry-personal'>
	<ul></ul>
	<input></input><button>Add</button>
	</div>
		<div class='hidden-fact community'>
			<h1>Show community responses</h1>
			<div class='reveal'>
				<div class='community-list' data-id='inquiry'>
					<ul></ul>
					<h2>Think one of your own questions belongs here? Add it to the list.</h2>
					<input></input><button>Add</button>
				</div>
			</div>
		</div>
		<div class='hidden-fact'>
			<h1>Show target question</h1>
			<div class='reveal'>
				<ul>
					<li>How long will the container take to fill?</li>
				</ul>
			</div>
		</div>
	</div>

	<div class='module'>
	
	<h1>What information do you need to answer the target question?</h1>
	<div class='input-list' data-id='facts-personal'>
	<ul></ul>
	<input></input><button>Add</button>
	</div>
	<div class='hidden-fact community'>
		<h1>Show community responses</h1>
		<div class='reveal'>
			<div class='community-list' data-id='facts'>
				<ul>
					<li>How big is the container?</li>
					<li>How much of the container fills up in the first video?</li>
					<li>How long does it take?</li>
				</ul>
				<h2>Think one of your own questions belongs here? Add it to the list.</h2>
				<label>Question:</label><input></input><button>Add</button>
			</div>
		</div>
	</div>
	</div>
	<div class='module'>
	<h1>Here are some facts that may help</h1>
		<div class='hidden-fact fact'>
			<h1><span class='psuedo'>Fact 1</span><span class='actual'>The dimensions of the container</span></h1>
			<div class='reveal'><img src='./dimensions.png'/></div>
		</div>
		<div class='hidden-fact fact'>
			<h1><span class='psuedo'>Fact 2</span><span class='actual'>The formula for the volume of a rectangular prism</span></h1>
			<div class='reveal'>Volume = length × breadth × height</div>
		</div>
		<div class='hidden-fact fact'>
			<h1><span class='psuedo'>Fact 3</span><span class='actual'>The speed of the water</span></h1>
			<div class='reveal'>
			<h2>Watch the video to see how long the measuring jug takes to fill 500mL.</h2>
			<div class='video-player'>
				<video>
					<source src='./measuring-jug.mp4'>
				</video>
				<div class='timer' data-start='6.5' data-end='12.75'>0:00</div>
			</div>
			</div>
		</div>
		<div class='hidden-fact'>
			<h1>Calculation</h1>
			<div class='reveal'>
				The jug fills up to 500mL in 6.25 seconds.
				<hr>Therefore, the water is running at a rate of 80cm<sup>3</sup> per second.
				<hr>The final time to fill the original container would be the Volume divided by the flow rate.
			</div>
		</div>
	</div>
	<div class='module'>
		<h1>Enter your final solution and submit.</h1>
		<div class="solution-input" data-id='solution'><input></input> Seconds <br><button>Check</button></div>
	</div>
	<div class='module'>
	<h1>Let's check our results.</h1>
	<h2>Play this video to see the solution. The timer will run automatically.</h2>
	<div class='video-player'>
	<video>
		<source src='./fill-complete.mp4'>
	</video>
	<div class='timer'>0:00</div>
	</div>
	</div>
	</div>
	<div class='lesson'>
	<div class='module'>
		<div class='chapter-header'>Chapter 2 : The Simulator</div>
	</div>
	<div class='module'>
	<h1>Let's experiment.</h1>
	<h2>Adjust the dimensions of the container and the flow-rate of the faucet and test the results.</h2>
	<div class='simulation'>
		<div class='box container'>
			<div class='box-side back'></div>
			<div class='box-side base'></div>
			<div class='box-side left'></div>
			<div class='box-side front'></div>
			<div class='box-side right'></div>
		</div>
		<div class='box fill'>
			<div class='box-side back'></div>
			<div class='box-side base'></div>
			<div class='box-side left'></div>
			<div class='box-side front'></div>
			<div class='box-side right'></div>
			<div class='box-side top'></div>
		</div>

		<div class='sliders'>
			<div class='slider width'><div class='slider-value'></div><div class='slider-thumb'></div><div class='slider-label'>Length</div></div>
			<div class='slider height'><div class='slider-value'></div><div class='slider-thumb'></div><div class='slider-label'>Height</div></div>
			<div class='slider depth'><div class='slider-value'></div><div class='slider-thumb'></div><div class='slider-label'>Breadth</div></div>
		</div>

		<div class='calculation'>
			l × h × b = V
			<br><span class='l'>l</span>cm × <span class='h'>h</span>cm × <span class='b'>b</span>cm = <span class='v'>v</span>cm<sup>3</sup>
		</div>

		<div class='faucet-info'>
			<select>
				<option value='80'>80cm³ per second</option>
				<option value='100'>100cm³ per second</option>
				<option value='250'>250cm³ per second</option>
				<option value='1000'>1000cm³ per second</option>
			</select>
		</div>
		<div class='faucet-water'></div>
		<div class='faucet'>
			
		</div>
		<div class='timer'>0:00</div>
		<div class='simulation-question-input'>
			<span class='simulation-question-text'></span>
			<div class='simulation-question-input-layer'><input></input><span class='simulation-question-unit'></span></div>
			<button>Check</button>
		</div>
	</div>
	<div class='module'>
		<h1>Can you predict the time to fill each box?</h1>
		<h2>The faucet is locked until you enter your answer.</h2>
		<div class='simulation-questions'>

		</div>
	</div>
	<div class='module'>
		<h1>Can you calculate the flow rate of each faucet?</h1>
		<h2>Run the simulation if required.</h2>
		<div class='simulation-questions'>

		</div>
	</div>
	<div class='module'>
		<h1>Can you figure calculate the volume of each box?</h1>
		<h2>Run the simulation if required.</h2>
		<div class='simulation-questions'>

		</div>
	</div>
	</div>
	</div>
	<div class="lesson">
	<div class='module'>
		<div class='chapter-header'>Chapter 3 : The Sequel</div>
	</div>
	<div class='module'>
		<h1>What other problems can we apply this knowledge to?<br>What other questions do we have?</h1>
		<div class='input-list' data-id='sequel-personal'>
		<ul></ul>
		<input></input><button>Add</button>
		</div>
		<div class='hidden-fact community'>
			<h1>Show community responses</h1>
			<div class='reveal'>
				<div class='community-list' data-id='sequel'>
					<ul>

					</ul>
					<h2>Think one of your own questions belongs here? Add it to the list.</h2>
					<input></input><button>Add</button>
				</div>
			</div>
		</div>
	</div>
	</div>
	<div class='lesson'>
		<div class='module'>
			<div class='chapter-header'>Chapter 4 : Results</div>
			<h1>What questions does this video raise for you?</h1>
			<div class='data-list' data-id='inquiry-personal'><ul></ul></div>
			<h1What information do you need to answer the target question?</h1>
			<div class='data-list' data-id='facts-personal'><ul></ul></div>
			<h1>Final solution attempts</h1>
			<div class='data-list' data-id='solution'><ul></ul></div>
			<h1>Simulation responses</h1>
			<h2>Question Set 1: Time</h2>
			<div class='data-list' data-id='time-1'><ul></ul></div><hr>
			<div class='data-list' data-id='time-2'><ul></ul></div><hr>
			<div class='data-list' data-id='time-3'><ul></ul></div><hr>
			<h2>Question Set 2: Rate</h2>
			<div class='data-list' data-id='rate-1'><ul></ul></div><hr>
			<div class='data-list' data-id='rate-2'><ul></ul></div><hr>
			<div class='data-list' data-id='rate-3'><ul></ul></div><hr>
			<h2>Question Set 3: Volume</h2>
			<div class='data-list' data-id='volume-1'><ul></ul></div><hr>
			<div class='data-list' data-id='volume-2'><ul></ul></div><hr>
			<div class='data-list' data-id='volume-3'><ul></ul></div><hr>
			<h1>What other problems can we apply this knowledge to?</h1>
			<h1>What other questions do we have?</h1>
			<div class='data-list' data-id='sequel-personal'><ul></ul></div>
		</div>
	</div>
	<div class='next-button-layer'><button class='next-button'>NEXT</button></div>
</body>
</html>